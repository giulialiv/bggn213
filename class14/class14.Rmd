---
title: "class14"
author: "Giulia Livrizzi"
date: "11/13/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
read.csv("airway_metadata.csv")
```

```{r}
read.csv("airway_scaledcounts.csv")
```

```{r}
counts <- read.csv("airway_scaledcounts.csv", stringsAsFactors = FALSE)
metadata <-  read.csv("airway_metadata.csv", stringsAsFactors = FALSE)
```

```{r}
head(counts)
```

```{r}
head(metadata)
```
#SETUP Bioconductor DESeq2
```{r eval=FALSE}
install.packages("BiocManager")
BiocManager::install()
BiocManager::install("DESeq2")
```
```{r}
head(metadata)
```
how many genes do we have in this data set?

```{r}
nrow(counts)
```
how many experiments?
```{r}
ncol(counts)-1
```
let's make sure metadata id col matches the colnames of counts
```{r}
colnames(counts)[-1]
```
```{r}
metadata$id
```

```{r}
all(colnames(counts)[-1] ==metadata$id)
```
all function to look across a vector of logicals
```{r}
all(c(T,T,T))
```
#Analysis: compare averages of controls are different from treated averages. First we need to access the columns of our countdata that are control and then find their mean.
```{r}
metadata$dex =="control"
```
#these are the columns I want to access
```{r}
control.id <-metadata[metadata$dex =="control", ]$id
control.id
```

```{r}
head(counts[,control.id])
```
#mean counts for control experiments(lenght(control.id) is number of columns -i.e. 4 here)
```{r}
control.mean <-rowSums(counts[,control.id])/length(control.id)
names(control.mean) <- counts$ensgene
```
#Do the same for drug treated exps
```{r}
treated <- metadata[metadata [,"dex"]=="treated",]
treated.mean <- rowSums(counts[, treated$id])/4
names(treated.mean) <- counts$ensgene
```
```{r}
meancounts <-data.frame(control.mean, treated.mean)
```
```{r}
plot(meancounts$control.mean, meancounts$treated.mean)
```
#Good case for a log plot
```{r}
plot(meancounts$control.mean, meancounts$treated.mean, log="xy")
```
#add new column called log2fc to see the fold change
```{r}
meancounts$log2fc <- log2(meancounts[,"treated.mean"]/meancounts[,"control.mean"])
head(meancounts)
```


